<div id="time" class="content">
    <div class="input-group">
        <label>時計を追加する</label>
        <select id="timeSelect" onchange="addClock()">
            <option value="">-- 都市を選択して追加 --</option>
            </select>
    </div>
    
    <div id="clockList" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        </div>
</div>

<script>
    // 最初に表示しておく都市
    let pinnedCities = ["Asia/Tokyo", "America/New_York", "Europe/London"];

    function updateClock() {
        const clockList = document.getElementById('clockList');
        // 初回のみ中身を作成、あとは時刻更新のみ
        if (clockList.innerHTML === "") {
            renderClocks();
        }

        pinnedCities.forEach(tz => {
            const options = { timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const timeStr = new Intl.DateTimeFormat('ja-JP', options).format(new Date());
            const clockEl = document.getElementById(`time-${tz.replace(/\//g, '-')}`);
            if (clockEl) clockEl.textContent = timeStr;
        });
    }

    function renderClocks() {
        const clockList = document.getElementById('clockList');
        clockList.innerHTML = "";
        pinnedCities.forEach(tz => {
            const country = countries.find(c => c.tz === tz) || {name: tz.split('/')[1]};
            const card = document.createElement('div');
            card.className = 'result-box';
            card.style.margin = "5px";
            card.style.padding = "10px";
            card.innerHTML = `
                <div style="font-size: 0.8rem;">${country.name}</div>
                <div class="clock-display" id="time-${tz.replace(/\//g, '-')}" style="font-size: 1.2rem; margin: 5px 0;">00:00:00</div>
                <button onclick="removeClock('${tz}')" style="padding: 2px 5px; font-size: 0.6rem; background: #ff4d4d; width: auto;">削除</button>
            `;
            clockList.appendChild(card);
        });
    }

    function addClock() {
        const tz = document.getElementById('timeSelect').value;
        if (tz && !pinnedCities.includes(tz)) {
            pinnedCities.push(tz);
            renderClocks();
        }
    }

    function removeClock(tz) {
        pinnedCities = pinnedCities.filter(c => c !== tz);
        renderClocks();
    }

    setInterval(updateClock, 1000);
</script>
