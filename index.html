<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Nomad - 50 Cities Edition</title>
    <style>
        body {
            margin: 0; padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: url('https://images.unsplash.com/photo-1488646953014-85cb44e25828?auto=format&fit=crop&w=1600&q=80') no-repeat center center fixed;
            background-size: cover;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; color: #333;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3); z-index: 1;
        }
        .container {
            position: relative; z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px); padding: 2rem;
            border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 90%; max-width: 500px; text-align: center;
        }
        .tabs { display: flex; margin-bottom: 1.5rem; border-bottom: 2px solid #eee; }
        .tab { flex: 1; padding: 12px; cursor: pointer; color: #999; font-weight: bold; transition: 0.3s; }
        .tab.active { color: #007bff; border-bottom: 2px solid #007bff; }
        
        .content { display: none; }
        .content.active { display: block; }

        .input-group { margin-bottom: 1rem; text-align: left; }
        label { display: block; font-size: 0.75rem; color: #666; margin-bottom: 5px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        
        button { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 10px; font-size: 1.1rem; cursor: pointer; margin-top: 10px; font-weight: bold; }
        
        .result-box { margin-top: 1.2rem; padding: 1.2rem; background: #f0f7ff; border-radius: 12px; font-size: 1.1rem; font-weight: bold; line-height: 1.5; }
        
        #clockList { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 1rem; max-height: 300px; overflow-y: auto; padding: 5px; }
        .clock-card { background: #f8f9fa; padding: 12px; border-radius: 15px; border: 1px solid #eee; position: relative; text-align: left; }
        .clock-city { font-size: 0.9rem; font-weight: bold; color: #1a1a1a; }
        .clock-country { font-size: 0.65rem; color: #888; margin-bottom: 5px; }
        .clock-time { font-size: 1.2rem; font-weight: bold; color: #007bff; font-family: 'Courier New', monospace; }
        .remove-btn { background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 14px; cursor: pointer; position: absolute; top: -8px; right: -8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div id="tab-curr" class="tab active" onclick="showTab('currency')">通貨換算</div>
        <div id="tab-time" class="tab" onclick="showTab('time')">世界時計</div>
    </div>

    <div id="currency" class="content active">
        <div class="input-group">
            <label>金額</label>
            <input type="number" id="amount" value="10000">
        </div>
        <div class="input-group">
            <label>変換元</label>
            <select id="fromCurr"></select>
        </div>
        <div class="input-group">
            <label>変換先</label>
            <select id="toCurr"></select>
        </div>
        <button onclick="calculateCurrency()">換算する</button>
        <div class="result-box" id="currResult">換算ボタンを押してください</div>
    </div>

    <div id="time" class="content">
        <div class="input-group">
            <label>都市を追加する</label>
            <select id="timeSelect" onchange="addClock()">
                <option value="">-- 都市を選択して追加 --</option>
            </select>
        </div>
        <div id="clockList"></div>
    </div>
</div>

<script>
    const locations = [
        // アジア
        { city: "東京", country: "日本", curr: "円", code: "JPY", tz: "Asia/Tokyo" },
        { city: "大阪", country: "日本", curr: "円", code: "JPY", tz: "Asia/Tokyo" },
        { city: "ソウル", country: "韓国", curr: "ウォン", code: "KRW", tz: "Asia/Seoul" },
        { city: "北京", country: "中国", curr: "元", code: "CNY", tz: "Asia/Beijing" },
        { city: "上海", country: "中国", curr: "元", code: "CNY", tz: "Asia/Shanghai" },
        { city: "香港", country: "香港", curr: "ドル", code: "HKD", tz: "Asia/Hong_Kong" },
        { city: "台北", country: "台湾", curr: "ドル", code: "TWD", tz: "Asia/Taipei" },
        { city: "シンガポール", country: "シンガポール", curr: "ドル", code: "SGD", tz: "Asia/Singapore" },
        { city: "バンコク", country: "タイ", curr: "バーツ", code: "THB", tz: "Asia/Bangkok" },
        { city: "ホーチミン", country: "ベトナム", curr: "ドン", code: "VND", tz: "Asia/Ho_Chi_Minh" },
        { city: "クアラルンプール", country: "マレーシア", curr: "リンギット", code: "MYR", tz: "Asia/Kuala_Lumpur" },
        { city: "ジャカルタ", country: "インドネシア", curr: "ルピア", code: "IDR", tz: "Asia/Jakarta" },
        { city: "マニラ", country: "フィリピン", curr: "ペソ", code: "PHP", tz: "Asia/Manila" },
        { city: "ムンバイ", country: "インド", curr: "ルピー", code: "INR", tz: "Asia/Kolkata" },
        { city: "デリー", country: "インド", curr: "ルピー", code: "INR", tz: "Asia/Kolkata" },
        { city: "ドバイ", country: "アラブ首長国連邦", curr: "ディルハム", code: "AED", tz: "Asia/Dubai" },
        { city: "リヤド", country: "サウジアラビア", curr: "リヤル", code: "SAR", tz: "Asia/Riyadh" },
        { city: "エルサレム", country: "イスラエル", curr: "シェケル", code: "ILS", tz: "Asia/Jerusalem" },
        { city: "イスタンブール", country: "トルコ", curr: "リラ", code: "TRY", tz: "Europe/Istanbul" },
        // ヨーロッパ
        { city: "ロンドン", country: "イギリス", curr: "ポンド", code: "GBP", tz: "Europe/London" },
        { city: "パリ", country: "フランス", curr: "ユーロ", code: "EUR", tz: "Europe/Paris" },
        { city: "ベルリン", country: "ドイツ", curr: "ユーロ", code: "EUR", tz: "Europe/Berlin" },
        { city: "ローマ", country: "イタリア", curr: "ユーロ", code: "EUR", tz: "Europe/Rome" },
        { city: "マドリード", country: "スペイン", curr: "ユーロ", code: "EUR", tz: "Europe/Madrid" },
        { city: "アムステルダム", country: "オランダ", curr: "ユーロ", code: "EUR", tz: "Europe/Amsterdam" },
        { city: "チューリッヒ", country: "スイス", curr: "フラン", code: "CHF", tz: "Europe/Zurich" },
        { city: "ウィーン", country: "オーストリア", curr: "ユーロ", code: "EUR", tz: "Europe/Vienna" },
        { city: "ストックホルム", country: "スウェーデン", curr: "クローナ", code: "SEK", tz: "Europe/Stockholm" },
        { city: "オスロ", country: "ノルウェー", curr: "クローネ", code: "NOK", tz: "Europe/Oslo" },
        { city: "コペンハーゲン", country: "デンマーク", curr: "クローネ", code: "DKK", tz: "Europe/Copenhagen" },
        { city: "ワルシャワ", country: "ポーランド", curr: "ズロチ", code: "PLN", tz: "Europe/Warsaw" },
        { city: "プラハ", country: "チェコ", curr: "コルナ", code: "CZK", tz: "Europe/Prague" },
        { city: "アテネ", country: "ギリシャ", curr: "ユーロ", code: "EUR", tz: "Europe/Athens" },
        // 北米・中南米
        { city: "ニューヨーク", country: "アメリカ", curr: "ドル", code: "USD", tz: "America/New_York" },
        { city: "ロサンゼルス", country: "アメリカ", curr: "ドル", code: "USD", tz: "America/Los_Angeles" },
        { city: "シカゴ", country: "アメリカ", curr: "ドル", code: "USD", tz: "America/Chicago" },
        { city: "トロント", country: "カナダ", curr: "ドル", code: "CAD", tz: "America/Toronto" },
        { city: "バンクーバー", country: "カナダ", curr: "ドル", code: "CAD", tz: "America/Vancouver" },
        { city: "メキシコシティ", country: "メキシコ", curr: "ペソ", code: "MXN", tz: "America/Mexico_City" },
        { city: "サンパウロ", country: "ブラジル", curr: "レアル", code: "BRL", tz: "America/Sao_Paulo" },
        { city: "ブエノスアイレス", country: "アルゼンチン", curr: "ペソ", code: "ARS", tz: "America/Argentina/Buenos_Aires" },
        { city: "サンティアゴ", country: "チリ", curr: "ペソ", code: "CLP", tz: "America/Santiago" },
        { city: "ボゴタ", country: "コロンビア", curr: "ペソ", code: "COP", tz: "America/Bogota" },
        { city: "リマ", country: "ペルー", curr: "ソル", code: "PEN", tz: "America/Lima" },
        // オセアニア・アフリカ
        { city: "シドニー", country: "オーストラリア", curr: "ドル", code: "AUD", tz: "Australia/Sydney" },
        { city: "メルボルン", country: "オーストラリア", curr: "ドル", code: "AUD", tz: "Australia/Melbourne" },
        { city: "オークランド", country: "ニュージーランド", curr: "ドル", code: "NZD", tz: "Pacific/Auckland" },
        { city: "カイロ", country: "エジプト", curr: "ポンド", code: "EGP", tz: "Africa/Cairo" },
        { city: "ヨハネスブルグ", country: "南アフリカ", curr: "ランド", code: "ZAR", tz: "Africa/Johannesburg" },
        { city: "ナイロビ", country: "ケニア", curr: "シリング", code: "KES", tz: "Africa/Nairobi" },
        { city: "カサブランカ", country: "モロッコ", curr: "ディルハム", code: "MAD", tz: "Africa/Casablanca" }
    ];

    const apiKey = 'e49db887bd065a8600690b11';
    let pinnedCities = ["Asia/Tokyo", "America/New_York", "Europe/London", "Europe/Paris"];

    function init() {
        const fromS = document.getElementById('fromCurr');
        const toS = document.getElementById('toCurr');
        const timeS = document.getElementById('timeSelect');

        // 都市名で五十音順（アルファベット順）にソート
        locations.sort((a, b) => a.city.localeCompare(b.city, 'ja')).forEach(l => {
            fromS.add(new Option(`${l.city} (${l.code})`, l.code));
            toS.add(new Option(`${l.city} (${l.code})`, l.code));
            timeS.add(new Option(`${l.city} (${l.country})`, l.tz));
        });
        
        fromS.value = "JPY"; toS.value = "USD";
        renderClocks();
        setInterval(updateClocks, 1000);
    }

    function showTab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + (id==='currency'?'curr':'time')).classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    async function calculateCurrency() {
        const amt = document.getElementById('amount').value;
        const from = document.getElementById('fromCurr').value;
        const to = document.getElementById('toCurr').value;
        const resultBox = document.getElementById('currResult');
        resultBox.innerText = "最新レートを取得中...";
        try {
            const url = `https://v6.exchangerate-api.com/v6/${apiKey}/pair/${from}/${to}/${amt}`;
            const response = await fetch(url);
            const data = await response.json();
            if (data.result === "success") {
                resultBox.innerHTML = `${Number(amt).toLocaleString()} ${from} = <br><span style="font-size: 1.6rem; color: #007bff;">${data.conversion_result.toLocaleString(undefined, {maximumFractionDigits: 2})} ${to}</span>`;
            }
        } catch (e) { resultBox.innerText = "接続エラー"; }
    }

    function renderClocks() {
        const list = document.getElementById('clockList');
        list.innerHTML = "";
        pinnedCities.forEach(tz => {
            const l = locations.find(item => item.tz === tz);
            if(!l) return;
            const div = document.createElement('div');
            div.className = 'clock-card';
            div.innerHTML = `
                <button class="remove-btn" onclick="removeClock('${tz}')">×</button>
                <div class="clock-city">${l.city}</div>
                <div class="clock-country">${l.country}</div>
                <div class="clock-time" id="time-${tz.replace(/\//g, '-')}">--:--:--</div>
            `;
            list.appendChild(div);
        });
        updateClocks();
    }

    function updateClocks() {
        pinnedCities.forEach(tz => {
            const el = document.getElementById(`time-${tz.replace(/\//g, '-')}`);
            if (el) {
                const time = new Intl.DateTimeFormat('ja-JP', { timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).format(new Date());
                el.textContent = time;
            }
        });
    }

    function addClock() {
        const tz = document.getElementById('timeSelect').value;
        if (tz && !pinnedCities.includes(tz)) {
            pinnedCities.push(tz);
            renderClocks();
        }
    }

    function removeClock(tz) {
        pinnedCities = pinnedCities.filter(t => t !== tz);
        renderClocks();
    }

    window.onload = init;
</script>

</body>
</html>
